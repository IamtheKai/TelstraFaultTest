function [Y,Xf,Af] = pre_severity(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 25-Apr-2016 22:47:02.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 4xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [1;1;1;1];
x1_step1.gain = [0.00010782252412529;0.00177777777777778;0.222222222222222;0.5];
x1_step1.ymin = -1;

% Layer 1
b1 = [-4.7429368699204995;4.3000043500082237;-4.0220977768430926;-4.2999789808475564;-3.733248226851654;3.6627708063852387;-3.7347489061956471;3.7337026075701547;3.8252269175351716;3.5091956609804513;3.5771308188457631;-4.0090133690555909;3.3978309429502507;-3.3481261892036609;-2.605254005840469;3.0386395168779754;-3.4848403903730536;-3.1811519751444157;-2.6279782439732737;-2.656881919016949;2.6306353498962518;2.5918684923397732;-2.5433622755677296;2.3582294786494402;2.7552373890234256;-1.9570756395142961;2.1187522925964024;-0.9734023417930513;2.0081835197338362;0.97103550334470867;0.85670966263703485;1.5770849235138249;-1.3823388374724028;-1.442304847912032;1.2029683193811329;-1.4108744486275651;0.63949594574842361;1.0117030582456734;-1.1684152776483785;0.55189654636081098;-0.56520772086939264;-0.93965727238377716;-1.2754586299842576;-0.4493033082002168;-0.34793639252440461;0.12625319117148659;0.20560927749300772;0.68284952494855844;-0.45921368879573965;-0.45480371420293886;-0.67367803505703849;0.72600267910384264;0.11868590368707022;-0.051662740240813125;0.65943042779340688;0.29888017053068944;-0.86528812742187544;0.26186680589767219;-0.47413468547498544;-0.86509206835376795;1.0330618315315641;0.76712857565542758;1.4830368404524001;-1.0485653647273387;1.1407072897529547;-1.4214980859970505;-1.5397911789995327;-1.3633692468107241;-1.4589009522665559;-0.97358643086314511;-1.9296653541111133;2.3933623221248439;2.0959117237599751;1.6602101799889835;2.2184158202465198;1.5013099332346231;2.6945321923341061;2.8406350416711006;-3.0040643464230854;-3.0817106505101179;2.3301600633131185;-2.8495042619603081;-2.7560926806976411;-2.6410448384929306;3.1669462187873472;-3.6681464109801061;2.9631645744317705;3.2643217167881247;-3.1644320051089161;-3.7501026839056779;-3.2454161370418046;3.4906751167057992;3.7978951139618391;3.7487012499501597;-3.5060377155848372;-3.8855976059523356;4.1836253560519925;3.7786822086495189;-4.3359068304979704;4.5421350199774446];
IW1_1 = [0.78273762527397084 0.52020728214312206 -3.5870880687769264 1.7781344490213387;-2.2087204246141545 2.4695741857720246 -0.018817568026577886 -3.0998907484414255;2.4951227520032813 -1.7705236550536221 1.0357113547337833 3.2697599112528626;2.0250761268024897 1.8200767233451756 -0.40119058426202781 -3.4007413826965442;2.1669158389062608 -1.7355880879408019 -2.8493124224290254 2.5052533349124326;-1.750805312252639 1.6519203695543825 -1.956605733562313 3.4592857677420326;-0.34546086378716012 2.4230919320121322 3.7906281391241503 0.35791877578356895;-1.3247624516916332 -1.6646165528449088 2.535682536955723 -3.025399044666389;-3.1146176982099898 -2.3444638237245408 -0.5456917905878389 -1.809309205451082;-0.68332378122147786 -3.6872027291554637 0.98243075003903468 1.902692541574474;-0.71336118305213547 2.3383093602532847 -1.9854003189493621 -3.0532266110387707;1.4764256630572621 -3.5719319727562837 -0.89757954345821223 -0.68013218978697587;-2.5176577113263225 -0.39471105712951104 -2.8073029931990177 2.153938597669641;0.038010720763709427 1.8312500331912605 3.1346534862020139 -3.1826674356124789;2.1049690515305319 -2.3688226263673835 -2.1472913333910628 2.4332872246192192;-2.6435881051087198 -1.7057027229478563 -1.1027274137004386 -2.8791513668848099;1.6126044705216278 -3.1053595183824649 0.74592022246259748 2.1215549045393307;2.693811328084176 -2.7994904448444737 -0.80771810722438353 0.90656718615316256;1.2429722246920378 -2.0855420019723274 -3.2121794660329468 -2.2549305398188713;2.682978981234883 1.2776368503942386 -3.3121436858281936 -0.33706267992016842;-3.9328774339304333 0.042698423117656863 1.8029938304284376 0.62088172481220982;-2.6447114273286174 -2.5380426328333123 -0.25470482550247842 -2.1691883604185591;1.1491063227237424 -3.2192898495937006 -0.70525592007012716 2.8945169725047317;-2.0064870096614125 1.7053845922933184 -3.2271897534130209 0.43769161710211035;-1.4879002959430767 1.6236923732069797 2.3358858937874984 -2.7146028904183299;2.5503885099905288 1.9765595632490414 3.0617341043763657 -0.90398406301763046;-1.5135174783384777 -3.5014103518491715 -2.3416056550905346 1.3314744595634838;0.66452676691614654 2.7283104030025314 -3.9709866073913833 -1.0671865700577139;-0.025287301036791127 -0.0017592347643861778 -4.0003930183363261 -2.8479281197839188;0.17203173353750048 2.8412957432127524 2.1378993341099926 -2.8340828199976094;-0.757383069027733 -1.5717797944283824 2.2871619288793159 -3.3903537035119564;-1.6056318904789653 -0.23633114650447748 1.1032177495624305 -4.1523126785404596;0.77294925208620291 3.0064964915483658 1.7294306300413094 2.6764202732942546;0.67992145464235954 -2.4329819891213362 0.52637318380478515 3.6317058789023124;-2.6725990840434868 0.70684451050729291 -3.3712794612097157 -0.95514815251398844;2.3915377781174296 -2.74778872336617 -1.8910650605471464 -1.3157880834307427;-3.5158718325539553 0.66197791596874234 -2.3102730314134425 1.2445766590459197;-2.3134351554525963 2.807121263732173 3.284684958661324 1.0807207817191351;1.1970370691723864 -3.1811170767575088 0.57112908830789477 2.8877916832918804;-0.4960159204962426 -0.38316698364996893 3.3104395814886733 -2.6678486825209791;-0.052117006346697643 3.533039539729748 3.1194813219614383 -0.34369642055304489;3.368801031880758 2.6172040725126196 0.073299244687943146 -0.74809480708778076;3.3573241104801692 -0.5702700168469198 2.859104774128586 -2.2738684778408227;2.6310281817314589 -2.8663667678789149 0.72233063679631471 1.5029097582425626;1.3426268416324854 -1.6026619165844898 -0.42146716101598253 -3.7036584659616465;-3.2958858290998996 -1.0838424331846488 -0.12789689355888678 -2.0307423356826422;-2.4591871749909182 1.9153903697347903 -2.543817611878517 1.8490943258522188;-0.18006704624397718 0.015364952742949772 4.2803389616043033 -2.310781441421399;0.64279389160796796 2.6871283367220737 -0.16983547544699207 -3.8758958778810961;-0.4054165232319632 -1.7762856449602784 3.3500624134479531 -2.7983022031199241;-2.9534788147149613 -2.2913264305070919 0.83099390742698531 2.4535301922331971;-2.1773026529905781 -1.2433300468298984 2.3377234394886881 2.3831073004574854;1.894910209367751 2.5142283175982318 0.66286658969039236 2.9891726578250517;-0.18504846310553991 2.8456274086245665 -3.3030670482851714 -0.8407241698532586;0.9031416189919238 -1.2018848538481259 1.0384407918700904 -4.2297620424672431;2.2589872180537656 -2.5775548312918533 2.3012259617128796 0.98989781838371271;-2.1214025026505943 -2.059460232023171 1.6120779233332405 2.6184075445831514;0.81569452548645671 -2.7912783723025871 -3.186064211943028 -1.0547832467898191;-2.6481218078769628 -1.206937887613593 0.39463190710333684 -3.4204375351024168;-2.108781637305023 2.5364952564347578 1.189046735001952 -3.2572443276220202;1.2889423373251434 -2.5007273532726098 0.31786659555137453 -3.3544703785161962;2.3765104884695076 1.5513653802524914 2.9117059077681602 -2.0804404768245943;2.1279690022795177 2.7426288228998437 -0.37465464652679514 2.1043308765183468;-3.1270713733384707 2.9865354174987635 -0.40407710473127234 3.1799093512377259;3.016202862076804 3.0940135466742418 0.42169126615970959 -0.38206952795928062;-2.2778541855016043 1.745547116565455 -3.5638129498676072 0.48310271763338242;-1.136978306886764 -3.8431790350690509 -1.1430460229284092 -1.2238190648624951;-2.0970826693457907 2.8538647986668542 -0.02166837649221514 -2.1298002204976112;-3.0058228381947485 1.3841240154015435 3.1024997092969899 0.61570449564134477;0.20996915433205929 -2.6531514551671544 0.16937488895930752 -4.2072671845614025;-0.7585525231293061 3.8419840169439525 -0.075816517091663399 2.3808208862628728;1.529005835792056 -1.4524883977430167 -2.1695267071630382 -3.1724537116530582;3.1285375526180199 2.2638786757383769 2.2004349154915941 -0.79109370300345105;0.46926799478551828 1.1759341661839291 1.7594373926666056 -3.7476967703685795;2.2246936196622684 -2.6196235633516287 2.5387509819709044 0.091082902760678305;1.3824652117008369 -3.175806685460707 1.6211795450329516 -2.4038892122122073;3.6399804556152593 -1.2440093237994763 1.8251039963706377 -1.389284400478962;1.7690265991399297 0.13926017081795822 2.7423767362671514 -2.7534120995740485;-2.0793660048012126 -2.5693801533722036 0.91646555701874566 -2.7150985549124362;-3.5313919571741841 2.0915071302653403 -0.21637723459631936 -1.1227654581091329;1.4452322970108644 2.7762057045091937 0.51516344778631251 -3.2461099622049816;-3.681991858533356 1.0671734965348554 -0.27519899791256919 -2.4226858179325741;-0.074502682991523378 4.2667458280412767 -2.1137095159359696 -0.49800976246630213;-0.8906242565184298 0.85151071730900207 3.4903541782077778 -2.7343563260247312;3.1249133308440959 0.41278082683441664 -2.5666976542133622 2.2135360534115653;-1.8996562184060579 2.5000710524793295 -2.6119859075300802 -0.68036457155378915;3.6264687659974779 -0.050996060237184539 1.4670905191992347 -2.0252702628658068;2.0123962798243684 2.4500745357268454 1.9006133303645869 -2.7939701582603051;0.21201534162584892 2.8442079730290235 2.3163218391734035 3.0849267922958195;-2.1427620228933932 -3.0692993435741531 1.832556096426551 -0.90467132050232779;-3.2778104778708217 -3.0087729529868179 0.25760595198656461 -2.1803424615176086;1.6793281885572824 0.063308458754048461 -0.39346329179290923 -4.2405216226657574;0.76541396568647913 3.8767852911918377 -2.4624189172713824 -0.14164363980323155;2.3800461464796223 0.84488256553670915 1.8728590050195888 -3.4277412420619351;-2.5101096978873683 -1.6469256037229778 3.7146950738393452 0.0055226816834684691;-3.0665769259815505 -1.7102811351435212 2.7684449415608969 1.3682042613950438;2.3364912937435376 3.9054202505735818 0.36029967682827219 0.57420488612579001;0.45066560673492501 -2.7304673644562034 3.4704295189590932 -2.0999038642376191;-1.0852001724304978 0.27138340907459774 3.5179688242393552 -2.3566772639831797;0.93097431544755371 -0.43668854006565577 0.16163114402898213 4.2135107320361724];

% Layer 2
b2 = 0.41029419924591209;
LW2_1 = [0.28265199866599905 -0.77659070657053542 0.65458691128401947 0.33210395522288999 0.16348452709956074 -0.38279628623606343 0.50819066556636916 0.48458574482460676 -0.32998461626030262 0.061059598596395301 0.48848424498037074 -0.11205710688641715 0.23357481172918265 0.64473185912222353 -0.25638060725562295 0.39351217723920356 -1.0585859540710345 0.4736689720712412 -0.3766417969417919 -0.090258609252401437 0.076313506976551759 0.60512516767248359 0.40355690475502287 0.41521733771018215 0.83306965886047757 0.2385580644309693 0.23314493174127524 -0.16237311927726367 0.97187728060962697 -0.30911296936348842 0.22578137642983148 -0.62569764634424141 -0.025363980812629326 -0.4593686241935297 -0.027187513747517746 -0.19074046429364647 -0.17560743759461067 -0.4666840525000524 -0.12993025075370962 -0.51715943631969918 -0.22584934782131419 0.10990273344382391 -0.41725145532361857 -0.037450595252743427 -1.0388349233304639 0.0094972366633806482 -0.25648609861243954 0.70760085362109959 0.27934113392210663 -0.40673346605167549 -0.15040121813300758 0.16558779889310207 -0.10837443170382965 -0.11906281872872421 0.8404109874449891 0.20007679978561024 0.28611924486354584 -0.62018246422252832 -0.31429058390066211 0.29419578677928426 0.095987556356181281 -0.10245664765595291 -0.38604178492925473 -0.3626854444117516 -0.1052039376115903 0.27800936393243769 0.082395325704248165 -0.44375011808051845 -0.16845379302928445 -0.14743788468592953 -0.62618038314962055 -0.37867102225362592 0.28467442331446069 -0.26394918181405991 0.16563523825917578 -0.16746091934361973 0.22883042270000362 0.28998206979936952 -0.32174527958034721 -0.011261574064452471 0.56826959492570617 -0.10668306172318934 0.37353581523964774 -0.74868928985887784 -0.32455645768355501 -0.19662945262146647 -0.49195301580718853 -0.61735076471725681 0.59274440508366411 -0.62068390825740727 0.33951825231442545 -0.055381089879243256 -0.72950272231215285 0.81884402815282098 -0.4185261714882022 0.56311733433189304 0.074029471970122412 -0.85838042048600582 -0.61000403556948701 -0.96970072948508546];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
